# 简介

在看流水线之前，需要了解什么是作业，什么是分组作业，什么是机器分批。

那么流水线就是一个CI/CD的一套过程，其中CD部分包括测试环境和线上环境，这两个环境使用同一个作业。通过分组作业灰度发布。

# 创建流水线

进入页面 【流水线】,如下图

创建流水线有两种方式，一个是创建空白流水线，一个是通过模版创建，任何一个流水线都可以保存成模版方便同类应用使用。

![空白页](/流水线/images/空白页.png)

创建流水线后可以对流水线进行如下操作

![流水线列表](/流水线/images/流水线列表.png)

# 进入


其中灰色按钮不可以点击，配置了对应的配置变成绿色按钮后才生效。
要回滚时点击对应的版本进行回滚。

![流水线详情](/流水线/images/流水线详情.jpg)

# 编辑

编辑一个流水线的配置，这里包括了流水线的整个配置
```
开关： 流水线开关，如流水线弃用可以设置成关闭。
定时发现tags： 开启后系统会定时查询git或者svn中的tag。如果关闭情况可以进入流水线进行手动触发一次发现。
自动构建： 发现tag后自动构建，如果关闭情况不会自动构建，需要进入流水线人为点击构建。
代码地址： git或者svn地址，通过地址类型系统自动判断是git还是svn，git通常以 “.git”结尾。
tag正则： 希望匹配的tag，默认情况下已经过滤release-开头的tag才有效。
票据： 拉代码需要的票据，票据在个人页面进行管理
依赖： 代码依赖，类似与git中的submodule。
build镜像： 构建代码需要的镜像。如不需要构建该处选择空。如选择了镜像，需要填写一个构建脚本。
构建过程，构建的脚本路径在/build/run 代码在/build/data 。构建结束需要生成目标目录/build/dist。
构建结束后，系统判断如果存在目标目录，则为构建成功。
所以这里目标目录的生产要是一个原子操作，可以先把目录生产在如/build/temp 然后mv /build/temp /build/dist来保证目标目录的完整。
触发脚本：构建结束后可以调用脚本进行二次处理，比如dockerbuild然后上传镜像到harbor （[点击查看触发脚本介绍](/构建触发脚本/README.md)）
脚本票据： 触发的脚本如果需要票据在这里选择上，如上传harbor需要权限，这里可以选择对应的票据。

```

发布配置：
```
自动触发线上发布： ON的情况下表示构建成功后自动触发线上环境的发布
自动触发测试发布： ON的情况下小时构建成功后自动触发测试环境的发布

系统会先调用测试环境的发布，然后调用线上环境的发布，如测试环境失败不会在调用线上环境的发布。
线上环境发布过程中不会自动填写回滚版本。（即没有配置回滚）

如果开关都打开的情况，构建过程先调用测试环境的发布，
等待测试环境正常结束后才调用线上环境的发布，但不会等线上发布结束直接退出。

```

![编辑空白页](/流水线/images/编辑空白页.png)


测试分组，线上分组。配置方式和机器分批方式一样。（[点击查看机器分批方式](/机器分批/README.md)）

![机器分组](/流水线/images/机器分组.png)

作业步骤。配置方式和作业管理中作业的配置方式一样。（[点击查看作业配置方式](/作业管理/README.md)）

![作业步骤](/流水线/images/作业步骤.png)


# 复制

复制这个流水线成另一个名称

# 存为模版

存为模版，在创建的时候可以选择模版来创建，模版的权限是全局的，存为模版后整个系统内可以共享

# 删除

删除该流水线，删除后不能恢复，请谨慎删除
