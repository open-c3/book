# 简介

在看流水线之前，需要了解什么是[分组作业](/分组作业/README.md)。

流水线是一个CI/CD的一整套过程，其中CD部分包括“测试环境”和“线上环境”，这两个环境使用同一个作业。通过分组作业灰度发布。

# 创建流水线

页面路径：【流水线】

创建流水线有两种方式，一个是创建空白流水线，一个是通过模版创建，任何一个流水线都可以保存成模版方便同类应用使用。

![空白页](/流水线/images/空白页.png)

创建流水线后可以对流水线进行如下操作。

![流水线列表](/流水线/images/流水线列表.png)

# 进入一个流水线

其中灰色按钮不可以点击，配置了对应的配置变成绿色按钮后才生效。

如要回滚时点击对应的版本进行回滚。

![流水线详情](/流水线/images/流水线详情.jpg)

# 编辑

编辑页面包括了流水线的整个配置：
```
开关： 流水线开关，如流水线弃用可以设置成关闭。
定时发现tags： 开启后系统会定时查询git或者svn中的tag。如果关闭情况可以进入流水线进行手动触发。
自动构建： 发现tag后自动构建，如果关闭情况不会自动构建，需要进入流水线手动点击。
代码地址： git或者svn地址，通过地址类型系统自动判断是git还是svn，git通常以 “.git”结尾。
tag正则： 希望匹配的tag，默认情况下已经过滤release-开头的tag才有效。
代码仓库票据： 拉代码需要的票据，票据在个人页面进行管理
依赖： 代码依赖，类似于git中的submodule。
build镜像： 构建代码需要的镜像。如不需要构建该处选择空。如选择了镜像，需要填写一个构建脚本。
    构建过程，构建的脚本路径在/build/run 代码在/build/data 。构建结束需要生成目标目录/build/dist。
    构建结束后，系统判断如果存在目标目录，判定为构建成功。
    所以这里目标目录的产生过程要是一个原子操作，可以先把目录生产在如/build/temp处，
    然后mv /build/temp /build/dist来保证目标目录的完整。
触发脚本：构建结束后可以调用脚本进行二次处理，比如docker build然后上传镜像到harbor。
脚本票据： 触发的脚本如果需要票据在这里选择上，如上传harbor需要权限，这里可以选择对应的票据。
```

发布配置：
```
自动触发线上发布： “ON”的情况下表示构建成功后自动触发线上环境的发布。
自动触发测试发布： “ON”的情况下表示构建成功后自动触发测试环境的发布。

系统会先调用测试环境的发布，然后调用线上环境的发布，如果测试环境发布失败则不会在调用线上环境的发布。
线上环境发布过程中会自动填写回滚版本。（上一次正常成功发布或者回滚的版本）

如果开关都打开的情况，构建过程先调用测试环境的发布，
等待测试环境正常结束后才调用线上环境的发布，但不会等线上发布结束就直接退出。
```

![编辑空白页](/流水线/images/编辑空白页.png)

测试分组和线上分组的配置方式和[机器分批](/机器分批/README.md)方式一样。

![机器分组](/流水线/images/机器分组.png)

作业步骤配置方式和[作业管理](/作业管理/README.md)中作业的配置方式一样。

![作业步骤](/流水线/images/作业步骤.png)

# 复制

通过一个流水线复制出另一个流水线。

# 存为模版

存为模版，在创建的时候可以选择模版来创建，模版的权限是全局的，存为模版后整个系统内共享。

# 删除

删除该流水线，删除后不能恢复，请谨慎删除。
