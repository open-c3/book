# 简介

正常情况下不会单独使用“发起审批”，一般在[作业任务](/作业任务/README.md)和[流水线](/流水线/README.md)中使用。

发起审批起到一个审批的作用，执行后审批人会收到消息，审批结束后任务继续往下执行。

页面路径： 【快速执行】->【发起审批】

# 页面介绍

![空白审批](/发起审批/images/空白审批.png)

## 作业名称

默认生成，也可以进行修改，在执行历史中可以通过名称查找。

## 审批内容(可使用变量)

审批人会查看到对应内容
```
审批内容可以使用变量，引入形式为：${变量名}

内部变量：
version            版本号。
_rollbackVersion_  回滚版本，发布线上时，如果选择了回滚版本，可以使用此变量。
ip                 发布目标机器ip。
_jobtype_          发布类型，值为test或online。
jobname            作业名。
flowname           流水线名称。
treename           服务树节点全称。
taginfo            版本改动详情：commit hash,commit message,committer列表。
submitter          提交人【注: >= v2.3.4 版本可用】
```

例:
审批内容可以写成如下:
```
发布审批
提交人: ${submitter};
作业名: ${jobname};
流水线名: ${flowname};
发布版本信息: ${taginfo};
服务树名: ${treename};
版本: ${version};
回滚版本: ${_rollbackVersion_};
```

## 审批人

多个审批人用“,”（英文逗号）分隔。

## 生效环境

流水线的发布区分“测试环境”和“线上环境”，这个配置控制该审批是在“测试环境”中生效还是“线上环境”中生效，还是同时生效。

如：
```
可以配置一个审批动作，选择“线上环境”生效，因为“线上环境”和“测试环境”用的是同一个作业的配置，
那么就可以做到发布过程中“测试环境”不用审批，“线上环境”需要审批。
```
## 生效动作

在流水线中的发布可以实时回滚，审批动作是一起进行配置的，这个开关可以控制该步骤的审批是“发布”时用还是“回滚”时用，还是不管发布和回滚都要执行。

## 分批

在流水线中使用该审批插件时，因为流水线中的发布存在灰度发布的过程。要发布的服务会进行分批。

该控制按钮用于控制是否是否每个批次都要运行该插件。

* 总是执行： 每一个分批的操作都会运行该审批动作。

* 仅第一个分组: 在一个分组作业中，只有第一个分批会调用该审批动作，后面的批次跳过审批。

* 仅最后一个分组: 在一个分组作业中，只有最后一个分批会调用该审批动作，之前的批次跳过审批。

## 所有审批人都要审批

当审批人是多人时，选择的效果：

* 是： 多个审批人都需要进行审批，如果有一个选择了不通过，则视为审批不通过。

* 只看第一个处理审批的人的结果。有人审批后，之后的审批无效。

# 试试吧

## 执行

![执行结果](/发起审批/images/执行结果.png)

## 控制台审批

![控制台审批](/发起审批/images/控制台审批.png)

## 移动端审批

通过飞书软件查看审批列表：

<img src="/发起审批/images/移动端审批列表.jpg" width=256 />

点击进入处理审批：

<img src="/发起审批/images/移动端审批.jpg" width=256 />
